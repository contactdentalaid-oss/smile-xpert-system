<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Inside <head> section -->
<link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile Xpert Dental Clinic - TV Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #0ea5e9;
            --primary-teal: #0d9488;
            --light-blue: #e0f2fe;
            --medical-white: #f8fafc;
            --dark-text: #1e293b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--medical-white);
            color: var(--dark-text);
            overflow: hidden;
        }
        
        .medical-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        
        .status-in-progress {
            background-color: #fef3c7;
            color: #92400e;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .status-next {
            background-color: #dcfce7;
            color: #166534;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .bengali-text {
            font-family: 'Poppins', sans-serif;
        }
        
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            box-sizing: border-box;
        }
        
        .marquee-content {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 30s linear infinite;
        }
        
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .image-slider {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }
        
        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="h-screen overflow-hidden">
    <!-- Page 1: Display Screen (TV View) -->
    <div class="container mx-auto h-screen p-6">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-400 to-teal-400 flex items-center justify-center mr-4">
                    <i class="fas fa-tooth text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Smile Xpert Dental Clinic</h1>
                    <p class="text-gray-600">Advanced Dental Care & Cosmetic Dentistry</p>
                </div>
            </div>
            
            <div class="text-right">
                <div id="digital-clock" class="text-4xl font-bold text-blue-600"></div>
                <div id="current-date" class="text-lg text-gray-700"></div>
            </div>
        </header>
        
        <main class="flex flex-col lg:flex-row gap-8 h-4/5">
            <!-- Left Side: Active Treatment Table -->
            <div class="medical-card lg:w-2/3 p-6">
                <div class="flex items-center mb-6">
                    <i class="fas fa-procedures text-blue-500 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">সক্রিয় চিকিত্সা তালিকা</h2>
                    <span class="ml-3 bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full" id="active-count">0</span>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-blue-50">
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">সার্জনের নাম</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">OT/ইউনিট নম্বর</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">রোগীর নাম</th>
                                <th class="px6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">স্ট্যাটাস</th>
                            </tr>
                        </thead>
                        <tbody id="active-treatment-body" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be populated by JavaScript -->
                            <tr>
                                <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-user-md text-4xl text-gray-300 mb-4"></i>
                                    <p class="text-lg">কোনও সক্রিয় চিকিত্সা পাওয়া যায়নি</p>
                                    <p class="text-sm mt-2">অ্যাডমিন প্যানেল থেকে রোগীর তথ্য যোগ করুন</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Right Side: Waiting List -->
            <div class="medical-card lg:w-1/3 p-6">
                <div class="flex items-center mb-6">
                    <i class="fas fa-clock text-teal-500 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">অপেক্ষমান তালিকা</h2>
                    <span class="ml-3 bg-teal-100 text-teal-800 text-sm font-semibold px-3 py-1 rounded-full" id="waiting-count">0</span>
                </div>
                
                <div class="space-y-4" id="waiting-list">
                    <!-- Data will be populated by JavaScript -->
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                        <p class="text-lg">অপেক্ষমান তালিকা খালি</p>
                        <p class="text-sm mt-2">অ্যাডমিন প্যানেল থেকে রোগী যোগ করুন</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Center Section: Image Slider -->
        <div class="my-8">
            <div class="image-slider medical-card h-64">
                <div id="slider-container" class="h-full w-full">
                    <!-- Images will be populated by JavaScript -->
                    <div class="h-full flex items-center justify-center bg-gradient-to-r from-blue-50 to-teal-50">
                        <div class="text-center">
                            <i class="fas fa-tooth text-5xl text-blue-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">Smile Xpert Dental Clinic</h3>
                            <p class="text-gray-600">ডেন্টাল টিপস স্লাইডার দেখতে ছবি আপলোড করুন</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer: Marquee Notice Board -->
        <footer class="mt-8">
            <div class="medical-card p-4">
                <div class="flex items-center mb-2">
                    <i class="fas fa-bullhorn text-blue-500 mr-2"></i>
                    <h3 class="text-lg font-semibold text-gray-800">নোটিস বোর্ড</h3>
                </div>
                <div class="marquee-container">
                    <div id="marquee-content" class="marquee-content text-lg text-gray-700">
                        <!-- Marquee content will be populated by JavaScript -->
                        স্বাগতম Smile Xpert ডেন্টাল ক্লিনিকে। আমাদের বিশেষজ্ঞ দল আপনাকে সর্বোচ্চ মানের ডেন্টাল যত্ন প্রদান করবে। আজকের বিশেষ অফার: দাঁতের সাদা করার জন্য ২০% ছাড়। আরও তথ্যের জন্য আমাদের সাথে যোগাযোগ করুন।
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Voice Announcement Modal (Hidden) -->
    <div id="announcement-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black opacity-50"></div>
        <div class="medical-card p-8 max-w-md z-10 text-center">
            <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-volume-up text-blue-500 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">পরবর্তী রোগী ডাকা হচ্ছে</h3>
            <p id="announced-patient" class="text-3xl font-bold text-teal-600 mb-6 bengali-text"></p>
            <button id="close-announcement" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg transition duration-300">
                বন্ধ করুন
            </button>
        </div>
    </div>
    
    <script>
        // Initialize shared functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize clock
            function updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const dateString = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                
                document.getElementById('digital-clock').textContent = timeString;
                document.getElementById('current-date').textContent = dateString;
            }
            
            setInterval(updateClock, 1000);
            updateClock();
            
            // Initialize data from localStorage
            loadDisplayData();
            
            // Initialize Broadcast Channel for real-time sync
            const broadcastChannel = new BroadcastChannel('smile-xpert-channel');
            
            // Listen for updates from admin panel
            broadcastChannel.onmessage = function(event) {
                if (event.data.type === 'data-updated') {
                    loadDisplayData();
                }
                
                if (event.data.type === 'call-next-patient') {
                    callNextPatient();
                }
            };
            
            // Close announcement modal
            document.getElementById('close-announcement').addEventListener('click', function() {
                document.getElementById('announcement-modal').classList.add('hidden');
            });
            
            // Initialize image slider
            initializeImageSlider();
        });
        
        function loadDisplayData() {
            // Load active treatments
            const treatments = JSON.parse(localStorage.getItem('activeTreatments') || '[]');
            const tbody = document.getElementById('active-treatment-body');
            
            if (treatments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-user-md text-4xl text-gray-300 mb-4"></i>
                            <p class="text-lg">কোনও সক্রিয় চিকিত্সা পাওয়া যায়নি</p>
                            <p class="text-sm mt-2">অ্যাডমিন প্যানেল থেকে রোগীর তথ্য যোগ করুন</p>
                        </td>
                    </tr>
                `;
                document.getElementById('active-count').textContent = '0';
            } else {
                let html = '';
                treatments.forEach((treatment, index) => {
                    const statusClass = treatment.status === 'In-Progress' ? 'status-in-progress' : 'status-next';
                    const statusText = treatment.status === 'In-Progress' ? 'চলমান' : 'পরবর্তী';
                    
                    html += `
                        <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} hover:bg-blue-50 transition duration-200">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 bengali-text">${treatment.surgeon}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${treatment.unit}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 bengali-text">${treatment.patient}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="${statusClass}">${statusText}</span>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                document.getElementById('active-count').textContent = treatments.length;
            }
            
            // Load waiting list
            const waitingList = JSON.parse(localStorage.getItem('waitingList') || '[]');
            const waitingContainer = document.getElementById('waiting-list');
            
            if (waitingList.length === 0) {
                waitingContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                        <p class="text-lg">অপেক্ষমান তালিকা খালি</p>
                        <p class="text-sm mt-2">অ্যাডমিন প্যানেল থেকে রোগী যোগ করুন</p>
                    </div>
                `;
                document.getElementById('waiting-count').textContent = '0';
            } else {
                let html = '';
                waitingList.forEach((patient, index) => {
                    html += `
                        <div class="flex items-center p-4 rounded-lg border border-gray-200 hover:bg-blue-50 transition duration-200">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-100 to-teal-100 flex items-center justify-center mr-4">
                                <span class="font-bold text-blue-700">${index + 1}</span>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800 bengali-text">${patient.name}</h4>
                                <p class="text-sm text-gray-600">প্রক্রিয়া: ${patient.procedure || 'সাধান্ত চেকআপ'}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-500">অপেক্ষার সময়</div>
                                <div class="font-semibold text-gray-700">${patient.waitTime || '১৫ মিনিট'}</div>
                            </div>
                        </div>
                    `;
                });
                
                waitingContainer.innerHTML = html;
                document.getElementById('waiting-count').textContent = waitingList.length;
            }
            
            // Load marquee content
            const marqueeContent = localStorage.getItem('marqueeContent') || 'স্বাগতম Smile Xpert ডেন্টাল ক্লিনিকে। আমাদের বিশেষজ্ঞ দল আপনাকে সর্বোচ্চ মানের ডেন্টাল যত্ন প্রদান করবে। আজকের বিশেষ অফার: দাঁতের সাদা করার জন্য ২০% ছাড়। আরও তথ্যের জন্য আমাদের সাথে যোগাযোগ করুন।';
            document.getElementById('marquee-content').textContent = marqueeContent;
            
            // Load slider images
            loadSliderImages();
        }
        
        function initializeImageSlider() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('.slider-image');
            
            if (slides.length > 1) {
                setInterval(() => {
                    slides[currentSlide].style.opacity = 0;
                    currentSlide = (currentSlide + 1) % slides.length;
                    slides[currentSlide].style.opacity = 1;
                }, 5000);
            }
        }
        
        function loadSliderImages() {
            const sliderContainer = document.getElementById('slider-container');
            const images = JSON.parse(localStorage.getItem('sliderImages') || '[]');
            
            if (images.length === 0) {
                // Default content if no images
                sliderContainer.innerHTML = `
                    <div class="h-full flex items-center justify-center bg-gradient-to-r from-blue-50 to-teal-50">
                        <div class="text-center">
                            <i class="fas fa-tooth text-5xl text-blue-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">Smile Xpert Dental Clinic</h3>
                            <p class="text-gray-600">ডেন্টাল টিপস স্লাইডার দেখতে ছবি আপলোড করুন</p>
                        </div>
                    </div>
                `;
            } else {
                let html = '';
                images.forEach((image, index) => {
                    if (index === 0) {
                        html += `<img src="${image}" alt="Dental Clinic Image" class="slider-image absolute top-0 left-0 w-full h-full object-cover" style="opacity: 1;">`;
                    } else {
                        html += `<img src="${image}" alt="Dental Clinic Image" class="slider-image absolute top-0 left-0 w-full h-full object-cover" style="opacity: 0;">`;
                    }
                });
                
                sliderContainer.innerHTML = html;
                // Reinitialize slider after loading images
                setTimeout(initializeImageSlider, 100);
            }
        }
        
        function callNextPatient() {
            const waitingList = JSON.parse(localStorage.getItem('waitingList') || '[]');
            const treatments = JSON.parse(localStorage.getItem('activeTreatments') || '[]');
            
            if (waitingList.length > 0) {
                const nextPatient = waitingList[0];
                
                // Show announcement modal
                document.getElementById('announced-patient').textContent = nextPatient.name;
                document.getElementById('announcement-modal').classList.remove('hidden');
                
                // Use Web Speech API to announce the patient's name in Bengali
                if ('speechSynthesis' in window) {
                    // Create a speech synthesis instance
                    const speech = new SpeechSynthesisUtterance();
                    
                    // Try to set Bengali language if available
                    const voices = speechSynthesis.getVoices();
                    const bengaliVoice = voices.find(voice => voice.lang.startsWith('bn'));
                    
                    if (bengaliVoice) {
                        speech.voice = bengaliVoice;
                        speech.lang = 'bn-BD';
                    }
                    
                    speech.text = `পরবর্তী রোগী, ${nextPatient.name}`;
                    speech.rate = 0.9;
                    speech.pitch = 1;
                    speech.volume = 1;
                    
                    speechSynthesis.speak(speech);
                }
                
                // Move patient from waiting list to active treatments as "Next"
                const newTreatment = {
                    surgeon: "ডা. আহমেদ করিম",
                    unit: "OT-2",
                    patient: nextPatient.name,
                    status: "Next"
                };
                
                // Add to active treatments
                treatments.push(newTreatment);
                localStorage.setItem('activeTreatments', JSON.stringify(treatments));
                
                // Remove from waiting list
                waitingList.shift();
                localStorage.setItem('waitingList', JSON.stringify(waitingList));
                
                // Update display after a short delay
                setTimeout(() => {
                    loadDisplayData();
                }, 3000);
            }
        }
    </script>
    <!-- At the end of <body> section -->
<script src="shared.js"></script>
<script src="tv-display.js"></script>
</body>
</html>
